(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/article_detail/article_detail"],{"0f98":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"container",attrs:{id:"comment_container"}},[a("view",{staticClass:"topper"}),a("view",{staticClass:"topper-box"},[a("view",{staticClass:"topper-box-list"},[a("image",{attrs:{src:"../../static/back.png",eventid:"d87efbba-0"},on:{tap:t.goBack}}),a("image",{attrs:{src:"../../static/more.png"}})])]),a("view",{staticClass:"list-border-space"}),a("view",{staticClass:"detail-box"},[a("text",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),a("view",{staticClass:"article-info-box"},[a("view",{staticClass:"article-info"},[a("image",{staticClass:"small-avatar",attrs:{src:t.article.avatar}}),a("text",{staticClass:"article-nickname"},[t._v(t._s(t.article.nickname))])]),a("view",{staticClass:"article-info-follow"},[t.userId==t.article.uId||t.followed?t._e():a("button",{staticClass:"followed-btn",attrs:{eventid:"d87efbba-1"},on:{tap:t.follow}},[t._v("关注")]),t.userId!=t.article.uId&&t.followed?a("button",{staticClass:" follow-btn cancel",attrs:{eventid:"d87efbba-2"},on:{tap:t.cancelFollow}},[t._v("已关注")]):t._e()],1)]),a("view",{staticClass:"article-info-createTime"},[a("text",{staticClass:"info-text"},[t._v("20.253 · 字数 "+t._s(t.article.content.length)+" · 阅读 50")]),a("text",{staticClass:"info-text"},[t._v(t._s(t.article.createTime))])]),a("view",{staticClass:"grace-text article-content"},[a("rich-text",{attrs:{nodes:t.article.content,bindtap:"tap",mpcomid:"d87efbba-0"}})],1)]),a("view",{staticClass:" article-flow"}),a("view",{staticClass:"detail-center"},[a("view",{staticClass:"detail-center-box"},[a("text",{staticClass:"info-text"},[t._v("评论("+t._s(t.comments.length)+")")]),a("text",{staticClass:"info-text"},[t._v("按时间倒序")])])]),a("view",{staticClass:"list-border-space"}),a("view",{staticClass:"detail-second-box"},[t._l(t.comments,function(e,i){return a("view",{key:i,staticClass:"comment-item"},[a("view",{staticClass:"left"},[a("image",{staticClass:"small-avatar",attrs:{src:e.avatar}})]),a("view",{staticClass:"right"},[a("view",{staticClass:"right-nickename"},[a("text",[t._v(t._s(e.nickname))])]),a("view",{staticClass:" right-content-box"},[a("text",[t._v(t._s(e.content))])]),a("view",{staticClass:"right-lou"},[a("text",[t._v(t._s(t.comments.length-i)+"楼")]),a("text",{staticClass:"right-commenttime"},[t._v(t._s(e.commentTime))])])])])}),a("view",{staticClass:"insertcomment",attrs:{id:"insertcomment"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"comment-box",attrs:{type:"text",placeholder:"写下你的评论",required:"required",eventid:"d87efbba-3"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}}),a("button",{attrs:{eventid:"d87efbba-4"},on:{tap:t.send}},[t._v("提交")])],1)],2),a("view",{staticClass:"comment-bottom"},[a("view",{staticClass:"list-border-space"}),a("view",{staticClass:"comment-bottom-box"},[a("view",{staticClass:"comment-bottom-small"},[a("image",{staticClass:"comment-bottom-avatar pinglun",attrs:{src:"../../static/pinglun.png",eventid:"d87efbba-5"},on:{tap:t.tocomment}}),a("text",[t._v("评论 "+t._s(t.comments.length))])]),t._m(0),a("view",{staticClass:"comment-bottom-small"},[a("view",{},[t.liked?t._e():a("image",{staticClass:"comment-bottom-avatar",attrs:{src:"../../static/xihuan.png",eventid:"d87efbba-6"},on:{tap:t.likeArticke}}),t.liked?a("image",{staticClass:"comment-bottom-avatar",attrs:{src:"../../static/xihuan2.png",eventid:"d87efbba-7"},on:{tap:t.cancelLike}}):t._e()]),a("text",[t._v("喜欢")])]),t._m(1)])])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"comment-bottom-small"},[a("image",{staticClass:"comment-bottom-avatar",attrs:{src:"../../static/zanshang.png"}}),a("text",[t._v("赞赏")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"comment-bottom-small"},[a("image",{staticClass:"comment-bottom-avatar",attrs:{src:"../../static/fenxiang.png"}}),a("text",[t._v("分享")])])}];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s})},"4a22":function(t,e,a){},a305:function(t,e,a){"use strict";a.r(e);var i=a("faf8"),s=a.n(i);for(var n in i)"default"!==n&&function(t){a.d(e,t,function(){return i[t]})}(n);e["default"]=s.a},b5bf:function(t,e,a){"use strict";a.r(e);var i=a("0f98"),s=a("a305");for(var n in s)"default"!==n&&function(t){a.d(e,t,function(){return s[t]})}(n);a("f5a1");var c=a("2877"),o=Object(c["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=o.exports},ed7d:function(t,e,a){"use strict";a("175f");var i=n(a("b0ce")),s=n(a("b5bf"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(s.default))},f5a1:function(t,e,a){"use strict";var i=a("4a22"),s=a.n(i);s.a},faf8:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(a("a03f"));function s(t){return t&&t.__esModule?t:{default:t}}var n={components:{uniGrid:i.default},data:function(){return{article:{aId:0,uId:0,title:"",content:"",avatar:"",nickname:"",createTime:""},comments:[],content:"",userId:t.getStorageSync("login_key").userId,followed:!1,liked:!1}},onLoad:function(t){this.article.aId=t.aId},onShow:function(){this.getArticle()},onPullDownRefresh:function(){this.getArticle()},methods:{goBack:function(){t.navigateBack({})},tocomment:function(){t.createSelectorQuery().select("#comment_container").boundingClientRect(function(e){t.pageScrollTo({scrollTop:e.bottom})}).exec()},getArticle:function(){var e=this,a=this;t.request({url:this.apiServer+"/article/"+this.article.aId,method:"GET",header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:this.userId},success:function(t){a.article.aId=t.data.data.article.id,a.article.uId=t.data.data.article.uid,a.article.title=t.data.data.article.title,a.article.content=t.data.data.article.content,a.article.nickname=t.data.data.article.nickname,a.article.avatar=t.data.data.article.avatar,a.article.createTime=t.data.data.article.createTime,a.comments=t.data.data.comments,a.article.createTime=e.handleTime(a.article.createTime);for(var i=0;i<a.comments.length;i++)a.comments[i].commentTime=e.handleTime(a.comments[i].commentTime);"已关注"===t.data.data.followed&&(a.followed=!0),"喜欢"===t.data.data.liked&&(a.liked=!0)},complete:function(){t.stopPullDownRefresh()}})},handleTime:function(t){var e=new Date(t),a=e.getFullYear(),i=e.getMonth()+1,s=e.getDate()<10?"0"+e.getDate():""+e.getDate(),n=e.getHours()<10?"0"+e.getHours():""+e.getHours(),c=e.getMinutes()<10?"0"+e.getMinutes():""+e.getMinutes(),o=e.getSeconds()<10?"0"+e.getSeconds():""+e.getSeconds();return a+"-"+i+"-"+s+" "+n+":"+c+":"+o},send:function(){var e=this,a=this;console.log("评论人编号："+this.userId+",文章编号："+this.article.aId+"，评论内容："+this.content),t.request({url:this.apiServer+"/comment/add",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{aId:this.article.aId,uId:this.userId,content:this.content},success:function(a){0===a.data.code&&(t.showToast({title:"简阅钻+5"}),e.getArticle(),e.content="")},complete:function(){var e=this,i=t.getStorageSync("login_key").score+5;t.request({url:"http://47.101.34.195:8080/api/user/score",method:"post",header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:a.userId,score:i},success:function(i){console.log(i.data),e.promptVisible=!1,t.request({url:"http://47.101.34.195:8080/api/user/"+t.getStorageSync("login_key").userId,method:"GET",data:{userId:a.userId},header:{"content-type":"application/json"},success:function(e){0==e.data.code&&t.setStorageSync("login_key",{userId:e.data.data.id,nickname:e.data.data.nickname,avatar:e.data.data.avatar,token:e.data.data.token,score:e.data.data.score,mobile:e.data.data.mobile,login:!0})}})}})}})},likeArticke:function(){var e=this,a=this;t.request({url:this.apiServer+"/like/add",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{aId:this.article.aId,uId:this.userId},success:function(a){t.showToast({title:"简阅钻+5"}),e.liked=!0},complete:function(){var e=this,i=t.getStorageSync("login_key").score+5;t.request({url:"http://47.101.34.195:8080/api/user/score",method:"post",header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:a.userId,score:i},success:function(i){console.log(i.data),e.promptVisible=!1,t.request({url:"http://47.101.34.195:8080/api/user/"+t.getStorageSync("login_key").userId,method:"GET",data:{userId:a.userId},header:{"content-type":"application/json"},success:function(e){0==e.data.code&&t.setStorageSync("login_key",{userId:e.data.data.id,nickname:e.data.data.nickname,avatar:e.data.data.avatar,token:e.data.data.token,score:e.data.data.score,mobile:e.data.data.mobile,login:!0})}})}})}})},cancelLike:function(){var e=this;t.request({url:this.apiServer+"/like/cancel",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{aId:this.article.aId,uId:this.userId},success:function(t){e.liked=!1}})},follow:function(){var e=this;t.request({url:this.apiServer+"/follow/add",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{fromUId:this.userId,toUId:this.article.uId},success:function(a){0===a.data.code&&(t.showToast({title:"关注成功"}),e.followed=!0)}})},cancelFollow:function(){var e=this;t.request({url:this.apiServer+"/follow/cancel",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{fromUId:this.userId,toUId:this.article.uId},success:function(a){0===a.data.code&&(t.showToast({title:"已取消关注"}),e.followed=!1)}})}}};e.default=n}).call(this,a("6e42")["default"])}},[["ed7d","common/runtime","common/vendor"]]]);